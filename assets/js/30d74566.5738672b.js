"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8472],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),p=d(n),u=o,f=p["".concat(s,".").concat(u)]||p[u]||m[u]||i;return n?a.createElement(f,l(l({ref:t},c),{},{components:n})):a.createElement(f,l({ref:t},c))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,l=new Array(i);l[0]=u;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[p]="string"==typeof e?e:o,l[1]=r;for(var d=2;d<i;d++)l[d]=n[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2616:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>f,frontMatter:()=>r,metadata:()=>d,toc:()=>p});var a=n(7462),o=n(3366),i=(n(7294),n(3905)),l=["components"],r={title:"Command Discovery Strategies"},s=void 0,d={unversionedId:"command_discovery_strategies",id:"command_discovery_strategies",title:"Command Discovery Strategies",description:"When oclif loads a plugin is must find all the commands within that plugin that can be executed. There a three strategies for discovering these commands:",source:"@site/../docs/command_discovery_strategies.md",sourceDirName:".",slug:"/command_discovery_strategies",permalink:"/docs/command_discovery_strategies",draft:!1,editUrl:"https://github.com/oclif/oclif.github.io/tree/docs/docs/../docs/command_discovery_strategies.md",tags:[],version:"current",lastUpdatedBy:"Mike Donnalley",lastUpdatedAt:1709583362,formattedLastUpdatedAt:"Mar 4, 2024",frontMatter:{title:"Command Discovery Strategies"},sidebar:"docs",previous:{title:"Plugin Loading",permalink:"/docs/plugin_loading"},next:{title:"Commands",permalink:"/docs/commands"}},c={},p=[{value:"<code>pattern</code> Strategy",id:"pattern-strategy",level:3},{value:"<code>explicit</code> Strategy",id:"explicit-strategy",level:3},{value:"Hooks",id:"hooks",level:4},{value:"Bundling",id:"bundling",level:4},{value:"<code>single</code> Strategy",id:"single-strategy",level:3},{value:"Note about <code>oclif.manifest.json</code>",id:"note-about-oclifmanifestjson",level:3}],m={toc:p},u="wrapper";function f(e){var t=e.components,n=(0,o.Z)(e,l);return(0,i.kt)(u,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"When oclif loads a plugin is must find all the commands within that plugin that can be executed. There a three strategies for discovering these commands:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"pattern")," - this is the default behavior that finds commands based on glob patterns."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"explicit")," - find commands that are exported from a specified file."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"single")," - CLI contains a single command executed by top-level bin.")),(0,i.kt)("h3",{id:"pattern-strategy"},(0,i.kt)("inlineCode",{parentName:"h3"},"pattern")," Strategy"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"pattern")," strategy tells oclif to use a predefined set of globs to find command files in a specified directory. This is the default behavior of oclif unless otherwise stated."),(0,i.kt)("p",null,"Plugins can point the ",(0,i.kt)("inlineCode",{parentName:"p"},"commands")," property to a directory"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "oclif": {\n    "commands": "./dist/commands",\n  }\n}\n')),(0,i.kt)("p",null,"This will tell oclif to look for commands in that directory (this is skipped if an ",(0,i.kt)("inlineCode",{parentName:"p"},"oclif.manifest.json")," is present)"),(0,i.kt)("p",null,"Alternatively, you can set this configuration which will do the exact same thing:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "oclif": {\n    "commands": {\n      "strategy": "pattern",\n      "target": "./dist/commands"\n    }\n  }\n}\n')),(0,i.kt)("p",null,"You also have the ability to set ",(0,i.kt)("inlineCode",{parentName:"p"},"globPatterns"),", which override the glob patterns that oclif uses when searching for command files:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "oclif": {\n    "commands": {\n      "strategy": "pattern",\n      "target": "./dist/commands",\n      "globPatterns": [\n         "**/*.+(js|cjs|mjs|ts|tsx|mts|cts)",\n        "!**/*.+(d.*|test.*|spec.*|helpers.*)?(x)"\n      ]\n    }\n  }\n}\n')),(0,i.kt)("p",null,"This is useful if you like to put test or helper files in the same directory as your command files."),(0,i.kt)("h3",{id:"explicit-strategy"},(0,i.kt)("inlineCode",{parentName:"h3"},"explicit")," Strategy"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"explicit")," strategy tells oclif to import commands from a single file. In this case the ",(0,i.kt)("inlineCode",{parentName:"p"},"target")," is the file that exports the commands and ",(0,i.kt)("inlineCode",{parentName:"p"},"identifier")," is the name of the export (defaults to ",(0,i.kt)("inlineCode",{parentName:"p"},"default"),")."),(0,i.kt)("p",null,"To use this you would add a new file (e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"src/commands.ts"),") and then add this configuration to the package.json"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "oclif": {\n    "commands": {\n      "strategy": "explicit",\n      "target": "./dist/index.js",\n      "identifier": "COMMANDS",\n    }\n  }\n}\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"src/index.ts")," would then need to have an export with the same name as the ",(0,i.kt)("inlineCode",{parentName:"p"},"identifier")," (if not set, it defaults to ",(0,i.kt)("inlineCode",{parentName:"p"},"default"),") that's an object of command names to command classes, e.g."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import Hello from './commands/hello'\nimport HelloWorld from './commands/hello/world'\n\nexport const COMMANDS = {\n  hello: Hello,\n  'hello:world': HelloWorld,\n  howdy: Hello, // alias the `hello` command to `howdy`\n}\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"explicit")," strategy is useful to those who can't rely on file paths because they've bundled their code (see ",(0,i.kt)("a",{parentName:"p",href:"#bundling"},"Bundling"),') but it can also be used if you simply prefer to be more explicit about your commands instead of relying on oclif "magically" finding commands from the file system.'),(0,i.kt)("p",null,"It can also be leveraged to create or modify commands at runtime (e.g. internationalize messages at runtime or add flags to a command based on an API spec - see ",(0,i.kt)("inlineCode",{parentName:"p"},"oclif + dynamic commands")," section below)."),(0,i.kt)("h4",{id:"hooks"},"Hooks"),(0,i.kt)("p",null,"Hooks can also be defined using the ",(0,i.kt)("inlineCode",{parentName:"p"},"explicit")," strategy:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'"oclif": {\n    "hooks": {\n      "init": {\n        "target": "./dist/index.js",\n        "identifier": "INIT_HOOK"\n      }\n    }\n}\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"// src/index.ts\nimport Hello from './commands/hello'\nimport HelloWorld from './commands/hello/world'\nexport {default as INIT_HOOK} from './hooks/init/init.js'\n\nexport const COMMANDS = {\n  hello: Hello,\n  'hello:world': HelloWorld,\n  howdy: Hello, // alias the `hello` command to `howdy`\n}\n")),(0,i.kt)("p",null,"That configuration is essentially telling oclif to look for an ",(0,i.kt)("inlineCode",{parentName:"p"},"INIT_HOOK")," export inside of ",(0,i.kt)("inlineCode",{parentName:"p"},"./dist/index.js")),(0,i.kt)("h4",{id:"bundling"},"Bundling"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"We do not support bundling")," given the endless number of tools + configurations that could be used. But if you choose to use a bundler, like ",(0,i.kt)("inlineCode",{parentName:"p"},"esbuild")," there are a couple hard requirements - you must have a package.json in your root directory and a ",(0,i.kt)("inlineCode",{parentName:"p"},"bin/run")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"bin/run.js")," bin script. ",(0,i.kt)("em",{parentName:"p"},"This means that you will not be able to successfully bundle your entire CLI (src code, package.json, node_modules, etc) into a single file.")),(0,i.kt)("p",null,"If you want to use a bundler, you can see this ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/oclif/plugin-test-esbuild/"},"example repo"),"."),(0,i.kt)("h3",{id:"single-strategy"},(0,i.kt)("inlineCode",{parentName:"h3"},"single")," Strategy"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"single")," strategy tells oclif that this CLI contains a single command that can be executed by the ",(0,i.kt)("inlineCode",{parentName:"p"},"bin/run.js")," (e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"ls")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"cat"),")."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "oclif": {\n    "commands": {\n      "strategy": "single",\n      "target": "./dist/index.js"\n    }\n  }\n}\n')),(0,i.kt)("p",null,"In this example, ",(0,i.kt)("inlineCode",{parentName:"p"},"./dist/index.js")," exports the command class."),(0,i.kt)("h3",{id:"note-about-oclifmanifestjson"},"Note about ",(0,i.kt)("inlineCode",{parentName:"h3"},"oclif.manifest.json")),(0,i.kt)("p",null,"For all strategies, the ",(0,i.kt)("inlineCode",{parentName:"p"},"oclif.manifest.json")," will be used to load the commands instead of the default behavior of the strategy."))}f.isMDXComponent=!0}}]);